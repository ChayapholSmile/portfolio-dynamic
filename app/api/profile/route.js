import { dbConnect } from '../../../lib/mongodb'; import Profile from '../../../models/Profile'; import { NextResponse } from 'next/server'; import { getUserFromCookie } from '../../../lib/jwt'; export async function GET(){ await dbConnect(); const [profile] = await Profile.find({}).limit(1); return NextResponse.json(profile || {}); } export async function PUT(req){ await dbConnect(); const me = getUserFromCookie(); if(!me || me.role !== 'admin') return NextResponse.json({ error:'forbidden' }, { status:403 }); const data = await req.json(); let profile = await Profile.findOne({}); if(!profile) profile = new Profile({}); profile.displayName = data.displayName || profile.displayName; profile.bio = data.bio || profile.bio; profile.avatar = data.avatar || profile.avatar; profile.social = data.social || profile.social; profile.createdBy = me.id; profile.updatedAt = new Date(); await profile.save(); return NextResponse.json({ ok:true }); }