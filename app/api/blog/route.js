import { dbConnect } from '../../../lib/mongodb'; import Blog from '../../../models/Blog'; import { NextResponse } from 'next/server'; import { getUserFromCookie } from '../../../lib/jwt'; export async function GET(){ await dbConnect(); const items = await Blog.find({}).sort({ createdAt:-1 }); return NextResponse.json({ items: JSON.parse(JSON.stringify(items)) }); } export async function POST(req){ await dbConnect(); const me = getUserFromCookie(); if(!me) return NextResponse.json({ error:'unauthorized' }, { status:401 }); const data = await req.json(); if(!data.slug) return NextResponse.json({ error:'slug required' }, { status:400 }); const exists = await Blog.findOne({ slug: data.slug }); if(exists) return NextResponse.json({ error:'slug exists' }, { status:400 }); const doc = await Blog.create({ ...data, author: me.id }); return NextResponse.json({ id: doc._id }); }