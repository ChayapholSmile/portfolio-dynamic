'use client'; import useSWR from 'swr'; import { useState } from 'react'; const fetcher = (url)=> fetch(url).then(r=>r.json()); export default function ChatPage(){ const { data, mutate } = useSWR('/api/chat?room=global', fetcher, { refreshInterval:3000 }); const [message,setMessage]=useState(''); const [sending,setSending]=useState(false); const send=async()=>{ if(!message) return; setSending(true); await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({room:'global',message})}); setMessage(''); setSending(false); mutate(); }; return (<div className="card p-4"><h1 className="text-2xl font-bold mb-4">แชทพูดคุย</h1><div className="h-96 overflow-y-auto space-y-2 mb-3">{data?.messages?.map(m=> (<div key={m._id} className="bg-white/5 rounded-lg p-2"><div className="text-sm text-white/70">{m.authorName||'ผู้ใช้'}</div><div>{m.message}</div><div className="text-xs text-white/50">{new Date(m.createdAt).toLocaleString()}</div></div>))}</div><div className="flex gap-2"><input className="input" placeholder="พิมพ์ข้อความ..." value={message} onChange={e=>setMessage(e.target.value)}/><button className="btn" onClick={send}>{sending?'กำลังส่ง...':'ส่ง'}</button></div></div>); }